import{V as s,i as t,p as a}from"./chunk-W6V62TGU.js";var i=class r{streamSubject=new a(null);stream$=this.streamSubject.asObservable();stream=null;subscribers=0;constructor(){}startCamera(){return t(this,null,function*(){if(this.subscribers++,this.stream&&this.stream.active)return console.log(`[CameraService] Returning existing stream. Subscribers: ${this.subscribers}`),this.stream;if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw console.warn("Camera API not available. This feature requires a Secure Context (HTTPS or localhost)."),new Error("Camera API not available (Secure Context required)");try{console.log("[CameraService] Requesting new camera stream...");let e=yield navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},facingMode:"user"},audio:!1});return this.stream=e,this.streamSubject.next(e),e.getVideoTracks()[0].onended=()=>{console.warn("[CameraService] Stream ended unexpectedly"),this.handleStreamEnd()},e}catch(e){throw console.error("Error accessing camera:",e),this.subscribers--,e}})}stopCamera(){this.subscribers--,console.log(`[CameraService] stopCamera called. Subscribers: ${this.subscribers}`),this.subscribers<=0&&this.forceStopCamera()}forceStopCamera(){console.log("[CameraService] Stopping camera stream completely."),this.stream&&(this.stream.getTracks().forEach(e=>e.stop()),this.stream=null,this.streamSubject.next(null)),this.subscribers=0}handleStreamEnd(){this.stream=null,this.streamSubject.next(null),this.subscribers=0}getStream(){return this.stream}static \u0275fac=function(o){return new(o||r)};static \u0275prov=s({token:r,factory:r.\u0275fac,providedIn:"root"})};export{i as a};
