import{L as W,Ra as Y,Ua as U,ab as q,ca as X,p as N}from"./chunk-4J375Q2P.js";import{a as z,b as H}from"./chunk-DCTPSYMH.js";import"./chunk-Q7GIVGAV.js";import{i as j,k as V,l as D,p as L,r as A}from"./chunk-75ZOJ57S.js";import{$a as G,$b as y,Bb as l,Cb as a,Db as s,Eb as m,Lb as Q,Ma as O,Oa as r,Pb as w,Rb as u,Ta as M,Ub as k,Vb as _,Wb as S,Xb as x,Yb as v,_b as c,ac as g,ca as T,da as I,ea as h,eb as f,fa as R,hc as F,ic as $,mc as E,oc as C,vb as P,zc as B}from"./chunk-W6V62TGU.js";var J=["rackContainer"],Z=["switchElement"],ee=["gpuElement"],te=()=>[1,2,3,4,5,6,7,8],ie=n=>({"opacity-50 grayscale":n}),ne=()=>[1,2,3];function re(n,t){if(n&1&&m(0,"div",29),n&2){let e=t.$implicit;x("animation-delay",e*100+"ms")}}function ae(n,t){if(n&1&&(h(),m(0,"line",31)),n&2){let e=u().$implicit,i=u(2);P("x1",i.switchPos.x+"%")("y1",i.switchPos.y+"%")("x2",e.x+"%")("y2",e.y+"%")}}function se(n,t){if(n&1&&(h(),a(0,"g"),f(1,ae,1,4,"line",30),s()),n&2){let e=t.$implicit;r(),l("ngIf",e.x&&e.y)}}function oe(n,t){if(n&1&&(h(),a(0,"g"),f(1,se,2,1,"g",10),s()),n&2){let e=t.$implicit;r(),l("ngForOf",e.gpus)}}function le(n,t){n&1&&(h(),m(0,"circle",32))}function ce(n,t){if(n&1&&(h(),m(0,"circle",33)),n&2){let e=t.$implicit;P("cx",e.startX+(e.targetX-e.startX)*(e.progress/100)+"%")("cy",e.startY+(e.targetY-e.startY)*(e.progress/100)+"%")}}function de(n,t){if(n&1&&(a(0,"div",58),m(1,"fa-icon",59),s()),n&2){let e=u().$implicit,i=u(2);r(),x("animation",e.fansSpeed>0?"spin "+2e3/(e.fansSpeed+10)+"ms linear infinite":"none")("opacity",.5+e.fansSpeed/200),l("icon",i.faWind)}}function me(n,t){if(n&1&&(a(0,"div",45,2)(2,"div",46)(3,"div",47),m(4,"fa-icon",48),a(5,"span",49),c(6),s()(),m(7,"fa-icon",50),s(),a(8,"div",51)(9,"span"),c(10),E(11,"number"),s(),a(12,"span"),c(13),E(14,"number"),s()(),a(15,"div",52),f(16,de,2,5,"div",53),s(),a(17,"div",54)(18,"div",55),c(19),s(),a(20,"div",56),m(21,"div",57),s()()()),n&2){let e=t.$implicit,i=u(2);x("box-shadow",e.active?"0 0 15px "+e.color:"none"),v("border-red-200",e.status==="overheating"||e.load>90),r(4),l("icon",i.faMicrochip),r(2),y(e.name),r(),v("text-yellow-400",e.active)("text-slate-200",!e.active),l("icon",i.faBolt),r(3),g("",C(11,19,e.temperature,"1.0-0"),"\xB0C"),r(3),g("MEM: ",C(14,22,e.memory,"1.0-0"),"GB"),r(3),l("ngForOf",F(25,ne)),r(3),g(" ",e.currentTask||"Ocioso..."," "),r(2),x("width",e.load,"%")("background-color",e.load>80?"#ef4444":e.load>50?"#eab308":"#22c55e")}}function pe(n,t){if(n&1){let e=Q();a(0,"div",34)(1,"div",35)(2,"div",36),m(3,"fa-icon",37),a(4,"span",38),c(5),s()(),a(6,"div",39)(7,"span",40),c(8),s(),a(9,"button",41),w("click",function(){let o=T(e).$implicit,d=u();return I(d.toggleServerStatus(o))}),c(10),s(),a(11,"button",42),w("click",function(){let o=T(e).$implicit,d=u();return I(d.toggleServerStatus(o))}),c(12),s()()(),a(13,"div",43),f(14,me,22,26,"div",44),s()()}if(n&2){let e=t.$implicit,i=u();r(),l("ngClass",$(23,ie,e.status==="offline")),r(2),v("text-green-500",e.status==="online")("text-red-500",e.status==="offline"),l("icon",i.faServer),r(2),y(e.id),r(2),v("bg-green-100",e.status==="online")("text-green-700",e.status==="online")("border-green-200",e.status==="online")("bg-red-100",e.status==="offline")("text-red-700",e.status==="offline")("border-red-200",e.status==="offline"),r(),g(" ",e.status==="online"?"ONLINE":"OFFLINE"," "),r(2),g(" ",e.status==="online"?"Simular Falha":"Reiniciar"," "),r(2),g(" ",e.status==="online"?"Desligar":"Ligar"," "),r(2),l("ngForOf",e.gpus)}}function fe(n,t){if(n&1&&(a(0,"div",60)(1,"span",61),c(2),s(),a(3,"span",62),c(4),s()()),n&2){let e=t.$implicit;r(2),y(e.name),r(2),g("",e.progress,"%")}}function ue(n,t){n&1&&(a(0,"div",63),c(1,"Sem tarefas pendentes"),s())}var K=class n{constructor(t){this.cdr=t}rackContainer;switchElement;gpuElements;faServer=X;faMicrochip=U;faNetworkWired=W;faWind=q;faBolt=Y;faTemperatureHigh=N;servers=[];packets=[];taskQueue=[];completedTasks=[];simulationInterval;taskGeneratorInterval;animationFrameId;switchPos={x:50,y:10};ngOnInit(){this.initializeRack()}ngAfterViewInit(){setTimeout(()=>{this.calculatePositions(),this.startSimulation()},500)}onResize(){this.calculatePositions()}ngOnDestroy(){this.simulationInterval&&clearInterval(this.simulationInterval),this.taskGeneratorInterval&&clearInterval(this.taskGeneratorInterval),this.animationFrameId&&cancelAnimationFrame(this.animationFrameId)}initializeRack(){for(let t=0;t<4;t++){let e=[];for(let i=0;i<3;i++)e.push({id:`gpu-${t}-${i}`,name:"RTX 4090",load:0,temperature:30,memory:0,fansSpeed:0,active:!1,status:"idle",color:"rgba(200, 200, 200, 0.1)"});this.servers.push({id:`server-${t}`,name:`AI-NODE-0${t+1}`,status:"online",cpuLoad:10,gpus:e})}}calculatePositions(){if(!this.rackContainer||!this.switchElement||!this.gpuElements)return;let t=this.rackContainer.nativeElement.getBoundingClientRect(),e=this.switchElement.nativeElement.getBoundingClientRect();this.switchPos={x:(e.left+e.width/2-t.left)/t.width*100,y:(e.top+e.height/2-t.top)/t.height*100};let i=this.gpuElements.toArray(),o=0;this.servers.forEach(d=>{d.gpus.forEach(p=>{if(o<i.length){let b=i[o].nativeElement.getBoundingClientRect();p.x=(b.left+b.width/2-t.left)/t.width*100,p.y=(b.top+b.height/2-t.top)/t.height*100,o++}})})}startSimulation(){this.simulationInterval=setInterval(()=>{this.processTasks(),this.updateHardwarePhysics(),this.generateTaskTraffic()},100),this.taskGeneratorInterval=setInterval(()=>{this.taskQueue.length<10&&this.generateTask()},2e3);let t=()=>{this.updatePackets(),this.animationFrameId=requestAnimationFrame(t)};t()}generateTask(){let t=["Treinamento de Lote","Infer\xEAncia YOLOv8","Processamento de Dados","Valida\xE7\xE3o de Modelo","Renderiza\xE7\xE3o NeRF","Fine-tuning LLM"],e=t[Math.floor(Math.random()*t.length)],i=Math.random().toString(36).substr(2,5).toUpperCase();this.taskQueue.push({id:`TASK-${i}`,name:e,complexity:Math.floor(Math.random()*50)+50,progress:0})}processTasks(){let t=this.getAllGpus().filter(i=>i.status==="idle"&&this.getServerOfGpu(i.id)?.status==="online");this.taskQueue.filter(i=>!i.assignedTo).forEach(i=>{if(t.length>0){t.sort((d,p)=>d.temperature-p.temperature);let o=t.shift();o&&(o.status="working",o.currentTask=i.name,i.assignedTo=o.id)}}),this.taskQueue.forEach((i,o)=>{if(i.assignedTo){let d=this.getGpuById(i.assignedTo),p=this.getServerOfGpu(i.assignedTo);if(!p||p.status!=="online"){i.assignedTo=void 0;return}d&&(i.progress+=2,d.load=Math.min(100,d.load+5),d.memory=Math.min(24,d.memory+.5),i.progress>=100&&this.completeTask(o,d))}})}completeTask(t,e){let i=this.taskQueue[t];this.completedTasks.unshift(i),this.completedTasks.length>5&&this.completedTasks.pop(),this.taskQueue.splice(t,1),e.status="idle",e.currentTask=void 0,e.load=0}generateTaskTraffic(){let t=this.getAllGpus().filter(e=>e.status==="working");if(t.length>0&&Math.random()>.5){let e=t[Math.floor(Math.random()*t.length)];this.packets.push({id:Date.now()+Math.random(),startX:this.switchPos.x,startY:this.switchPos.y,targetX:e.x||50,targetY:e.y||50,progress:0,targetGpuId:e.id})}}updatePackets(){for(let e=this.packets.length-1;e>=0;e--){let i=this.packets[e];i.progress+=2,i.progress>=100&&(this.processPacketHit(i.targetGpuId),this.packets.splice(e,1))}this.cdr.detectChanges()}processPacketHit(t){let e=this.getGpuById(t);e&&(e.active=!0)}updateHardwarePhysics(){this.servers.forEach(t=>{t.status==="online"?(t.cpuLoad=Math.max(5,Math.min(100,t.cpuLoad+(Math.random()*4-2))),t.gpus.forEach(e=>{e.status==="idle"&&(e.load=Math.max(0,e.load-5),e.memory=Math.max(0,e.memory-1));let i=30+e.load*.6;if(e.temperature+=(i-e.temperature)*.05,e.fansSpeed=Math.max(0,(e.temperature-30)*1.5),e.load<5)e.color="rgba(226, 232, 240, 0.2)",e.active=!1;else{let o=Math.max(0,120-e.load*1.2),d=60,p=.5+e.load/200;e.color=`hsla(${o}, 80%, ${d}%, ${p})`}})):(t.cpuLoad=0,t.gpus.forEach(e=>{e.load=0,e.fansSpeed=Math.max(0,e.fansSpeed-2),e.temperature=Math.max(20,e.temperature-.5),e.color="rgba(50, 50, 50, 0.1)",e.active=!1}))})}getAllGpus(){return this.servers.flatMap(t=>t.gpus)}getGpuById(t){return this.getAllGpus().find(e=>e.id===t)}getServerOfGpu(t){return this.servers.find(e=>e.gpus.some(i=>i.id===t))}toggleServerStatus(t){t.status=t.status==="online"?"offline":"online"}static \u0275fac=function(e){return new(e||n)(M(B))};static \u0275cmp=G({type:n,selectors:[["app-physical-server-rack"]],viewQuery:function(e,i){if(e&1&&(k(J,5),k(Z,5),k(ee,5)),e&2){let o;_(o=S())&&(i.rackContainer=o.first),_(o=S())&&(i.switchElement=o.first),_(o=S())&&(i.gpuElements=o)}},hostBindings:function(e,i){e&1&&w("resize",function(){return i.onResize()},O)},decls:36,vars:16,consts:[["rackContainer",""],["switchElement",""],["gpuElement",""],[1,"w-full","min-h-full","bg-white","p-2","sm:p-4","rounded-xl","overflow-hidden","relative","flex","flex-col","items-center","border","border-slate-200","shadow-lg"],[1,"absolute","inset-0","opacity-30","pointer-events-none",2,"background-image","radial-gradient(#cbd5e1 1px, transparent 1px)","background-size","20px 20px"],[1,"relative","z-10","w-full","max-w-xs","sm:w-64","h-12","bg-white","border","border-slate-200","rounded-lg","shadow-md","flex","items-center","justify-between","px-4","mb-8","shrink-0"],[1,"flex","gap-1"],["class","w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full bg-gray-300 animate-pulse",3,"animation-delay",4,"ngFor","ngForOf"],[1,"text-[10px]","sm:text-xs","font-mono","text-unrender-purple","font-bold"],[1,"absolute","inset-0","w-full","h-full","pointer-events-none","z-0"],[4,"ngFor","ngForOf"],["r","3","fill","#818cf8","filter","url(#glow)",4,"ngFor","ngForOf"],["r","3","fill","#6366f1",4,"ngFor","ngForOf"],[1,"relative","z-10","w-full","max-w-4xl","flex-1","flex","flex-col","gap-4","p-2","sm:p-4","bg-gray-50","border","border-slate-200","rounded-xl","backdrop-blur-sm","shadow-sm","overflow-y-auto"],["class","w-full bg-white border border-slate-200 rounded-lg p-2 flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4 shadow-sm",4,"ngFor","ngForOf"],[1,"relative","z-10","w-full","max-w-4xl","mt-4","bg-white","border","border-slate-200","rounded-lg","p-2","flex","flex-col","sm:flex-row","gap-4","h-32","overflow-hidden","shadow-sm"],[1,"flex-1","flex","flex-col","min-w-0"],[1,"text-[10px]","uppercase","font-bold","text-slate-500","mb-2","flex","justify-between"],[1,"bg-unrender-purple","text-white","px-1","rounded"],[1,"overflow-y-auto","space-y-1","custom-scrollbar","pr-1"],["class","text-[9px] bg-slate-50 p-1.5 rounded border-l-2 border-unrender-purple flex justify-between items-center",4,"ngFor","ngForOf"],["class","text-center text-slate-300 text-[9px] italic p-2",4,"ngIf"],[1,"w-full","sm:w-1/3","border-t","sm:border-t-0","sm:border-l","border-slate-100","pt-2","sm:pt-0","sm:pl-4","flex","flex-col","justify-center","gap-2"],[1,"flex","justify-between","items-center","text-[10px]","text-slate-600"],[1,"text-yellow-500","mr-1",3,"icon"],[1,"font-bold","font-mono"],[1,"w-full","bg-gray-100","h-1.5","rounded-full","overflow-hidden"],[1,"bg-yellow-400","h-full","transition-all","duration-500"],[1,"text-[8px]","text-slate-400","text-right","mt-1"],[1,"w-1.5","h-1.5","sm:w-2","sm:h-2","rounded-full","bg-gray-300","animate-pulse"],["stroke","#cbd5e1","stroke-width","1","stroke-dasharray","4 4","opacity","0.5",4,"ngIf"],["stroke","#cbd5e1","stroke-width","1","stroke-dasharray","4 4","opacity","0.5"],["r","3","fill","#818cf8","filter","url(#glow)"],["r","3","fill","#6366f1"],[1,"w-full","bg-white","border","border-slate-200","rounded-lg","p-2","flex","flex-col","sm:flex-row","items-start","sm:items-center","gap-2","sm:gap-4","shadow-sm"],[1,"w-full","sm:w-24","flex","sm:flex-col","items-center","justify-between","sm:justify-center","border-b","sm:border-b-0","sm:border-r","border-slate-200","pb-2","sm:pb-0","sm:pr-2",3,"ngClass"],[1,"flex","items-center","gap-2","sm:flex-col"],[1,"text-lg","sm:text-xl","mb-0","sm:mb-1","transition-colors",3,"icon"],[1,"text-[10px]","font-mono","text-slate-500"],[1,"flex","flex-col","gap-1","items-end","sm:items-center","mt-0","sm:mt-2"],[1,"text-[9px]","font-bold","px-1.5","py-0.5","rounded","border"],[1,"text-[8px]","sm:text-[9px]","px-2","py-1","rounded","bg-white","border","border-slate-300","hover:bg-slate-100","transition-colors","text-slate-600","whitespace-nowrap","hidden","sm:block",3,"click"],[1,"sm:hidden","text-[8px]","text-red-500","underline",3,"click"],[1,"w-full","grid","grid-cols-3","gap-1","sm:gap-4"],["class","relative rounded border border-slate-200 p-1 flex flex-col items-center justify-between transition-colors duration-300 min-h-0 bg-white",3,"box-shadow","border-red-200",4,"ngFor","ngForOf"],[1,"relative","rounded","border","border-slate-200","p-1","flex","flex-col","items-center","justify-between","transition-colors","duration-300","min-h-0","bg-white"],[1,"w-full","flex","justify-between","items-center","text-[8px]","font-mono","text-slate-600","mb-0.5"],[1,"flex","items-center","gap-1","overflow-hidden"],[1,"text-slate-400",3,"icon"],[1,"truncate","max-w-[60px]"],[1,"text-[8px]","transition-colors",3,"icon"],[1,"w-full","flex","justify-between","text-[7px]","text-slate-400","mb-0.5","font-mono"],[1,"flex","gap-0.5","sm:gap-2","items-center","justify-center","w-full","py-0.5"],["class","w-4 h-4 sm:w-8 sm:h-8 rounded-full border border-slate-200 flex items-center justify-center relative overflow-hidden bg-gray-50 shrink-0",4,"ngFor","ngForOf"],[1,"w-full","mt-0.5"],[1,"text-[7px]","text-center","truncate","w-full","h-3","mb-0.5","text-slate-500","bg-slate-50","rounded","px-1","border","border-slate-100"],[1,"w-full","h-1","bg-gray-200","rounded-full","overflow-hidden"],[1,"h-full","transition-all","duration-300"],[1,"w-4","h-4","sm:w-8","sm:h-8","rounded-full","border","border-slate-200","flex","items-center","justify-center","relative","overflow-hidden","bg-gray-50","shrink-0"],[1,"text-slate-300","text-[10px]","sm:text-sm","transition-transform",3,"icon"],[1,"text-[9px]","bg-slate-50","p-1.5","rounded","border-l-2","border-unrender-purple","flex","justify-between","items-center"],[1,"truncate","text-slate-700","mr-2"],[1,"text-slate-400"],[1,"text-center","text-slate-300","text-[9px]","italic","p-2"]],template:function(e,i){e&1&&(a(0,"div",3,0),m(2,"div",4),a(3,"div",5,1)(5,"div",6),f(6,re,1,2,"div",7),s(),a(7,"div",8),c(8,"CORE-SWITCH-01"),s()(),h(),a(9,"svg",9),f(10,oe,2,1,"g",10)(11,le,1,0,"circle",11)(12,ce,1,2,"circle",12),s(),R(),a(13,"div",13),f(14,pe,15,25,"div",14),s(),a(15,"div",15)(16,"div",16)(17,"h4",17),c(18," Fila de Processamento "),a(19,"span",18),c(20),s()(),a(21,"div",19),f(22,fe,5,2,"div",20)(23,ue,2,0,"div",21),s()(),a(24,"div",22)(25,"div",23)(26,"span"),m(27,"fa-icon",24),c(28," Consumo Total"),s(),a(29,"span",25),c(30),E(31,"number"),s()(),a(32,"div",26),m(33,"div",27),s(),a(34,"div",28),c(35,"Simula\xE7\xE3o em Tempo Real"),s()()()()),e&2&&(r(6),l("ngForOf",F(15,te)),r(4),l("ngForOf",i.servers),r(),l("ngForOf",i.packets),r(),l("ngForOf",i.packets),r(2),l("ngForOf",i.servers),r(6),y(i.taskQueue.length),r(2),l("ngForOf",i.taskQueue),r(),l("ngIf",i.taskQueue.length===0),r(4),l("icon",i.faBolt),r(3),g("",C(31,12,300+i.packets.length*50,"1.0-0"),"W"),r(3),x("width",(300+i.packets.length*50)/20,"%"))},dependencies:[A,j,V,D,H,z,L],styles:["@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}[_nghost-%COMP%]{display:block;height:100%;width:100%}"]})};export{K as PhysicalServerRackComponent};
