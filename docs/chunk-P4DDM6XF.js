import{a as y}from"./chunk-BFOI3DTS.js";import{a as p}from"./chunk-GGNV32RQ.js";import{a as L,b as Q,e as V,i as W}from"./chunk-OSXEUPW2.js";import{d as A}from"./chunk-Q7GIVGAV.js";import{r as k}from"./chunk-75ZOJ57S.js";import{$a as S,Bb as M,Cb as a,Db as r,Eb as C,Ia as P,Lb as x,Oa as o,Pb as v,Rb as w,Ta as _,Ub as u,Vb as d,Wb as g,_b as O,ac as E,ca as l,cc as B,da as c,dc as T,ec as I,wb as m,xb as f}from"./chunk-W6V62TGU.js";var R=["userBubble"],z=["assistantBubble"],D=["loadingBubble"],K=["sendButton"],U=["messageInput"];function j(s,t){s&1&&(a(0,"div",7)(1,"p"),O(2,"Ol\xE1! Sou a IA da Unrender. Me pergunte algo!"),r()())}function H(s,t){if(s&1&&(a(0,"div",8)(1,"div",15,2),O(3),r()()),s&2){let e=w();o(3),E(" ",e.latestUserMessage," ")}}function q(s,t){if(s&1&&(a(0,"div",9)(1,"div",16,3),C(3,"div",17),r()()),s&2){let e=w();o(3),M("innerHTML",e.parseMarkdown(e.latestAssistantMessage),P)}}function F(s,t){s&1&&(a(0,"div",9)(1,"div",16,4)(3,"div",18),C(4,"span")(5,"span")(6,"span"),r()()())}var $=class s{constructor(t,e){this.chatService=t;this.sanitizer=e;this.systemMessageTemplates=this.chatService.getSystemMessageTemplates()}systemMessage=y.SYSTEM_MESSAGES.DEFAULT;apiKey="";userBubbles;assistantBubbles;loadingBubbles;sendButtons;messageInputs;messages=[];currentMessage="";isLoading=!1;latestUserMessage="";latestAssistantMessage="";systemMessageTemplates;ngOnInit(){this.apiKey&&this.chatService.setApiKey(this.apiKey)}setSystemMessage(t){this.systemMessage=this.chatService.getSystemMessage(t)}ngAfterViewInit(){let t=document.querySelector(".input-area");t&&p.fromTo(t,{opacity:0,y:20},{opacity:1,y:0,duration:.8,ease:"power3.out"}),this.animateBubbles(),this.userBubbles.changes.subscribe(()=>this.animateBubbles()),this.assistantBubbles.changes.subscribe(()=>this.animateBubbles()),this.loadingBubbles.changes.subscribe(()=>this.animateBubbles())}animateBubbles(){this.userBubbles.forEach((t,e)=>{p.fromTo(t.nativeElement,{opacity:0,x:50,scale:.8},{opacity:1,x:0,scale:1,duration:.6,ease:"back.out(1.7)",delay:e*.1})}),this.assistantBubbles.forEach((t,e)=>{p.fromTo(t.nativeElement,{opacity:0,x:-50,scale:.8},{opacity:1,x:0,scale:1,duration:.6,ease:"back.out(1.7)",delay:e*.1})}),this.loadingBubbles.forEach((t,e)=>{p.fromTo(t.nativeElement,{opacity:0,scale:.5},{opacity:1,scale:1,duration:.4,ease:"power2.out",delay:e*.1})})}onInputFocus(){}onInputBlur(){}onEnterKey(t){let e=t;e.shiftKey||(e.preventDefault(),this.sendMessage())}parseMarkdown(t){if(!t)return"";let e=t;return e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/\*(.*?)\*/g,"<em>$1</em>"),e=e.replace(/^(\d+)\.\s+(.+)$/gm,"<ol><li>$2</li></ol>"),e=e.replace(/^[-*]\s+(.+)$/gm,"<ul><li>$1</li></ul>"),e=e.replace(/`([^`]+)`/g,"<code>$1</code>"),e=e.replace(/```([^```]+)```/g,"<pre><code>$1</code></pre>"),e=e.replace(/^###\s+(.+)$/gm,"<h3>$1</h3>"),e=e.replace(/^##\s+(.+)$/gm,"<h2>$1</h2>"),e=e.replace(/^#\s+(.+)$/gm,"<h1>$1</h1>"),e=e.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>'),e=e.replace(/\n/g,"<br>"),e=e.replace(/(<br>\s*){3,}/g,"<br><br>"),this.sanitizer.bypassSecurityTrustHtml(e)}sendMessage(){let t=this.currentMessage.trim();t===""||this.isLoading||(this.sendButtons.forEach(e=>{p.to(e.nativeElement,{scale:.9,duration:.1,yoyo:!0,repeat:1,ease:"power2.inOut"})}),this.messages=[{role:"user",content:t}],this.latestUserMessage=t,this.latestAssistantMessage="",this.currentMessage="",this.isLoading=!0,this.chatService.getGeminiResponse(this.systemMessage,this.messages).subscribe({next:e=>{this.messages.push({role:"assistant",content:e}),this.latestAssistantMessage=e,this.isLoading=!1},error:e=>{console.error("Chatbot API error:",e),this.messages.push({role:"assistant",content:"Desculpe, encontrei um erro. Tente novamente."}),this.latestAssistantMessage="Desculpe, encontrei um erro. Tente novamente.",this.isLoading=!1}}))}static \u0275fac=function(e){return new(e||s)(_(y),_(A))};static \u0275cmp=S({type:s,selectors:[["app-chat-widget"]],viewQuery:function(e,n){if(e&1&&(u(R,5),u(z,5),u(D,5),u(K,5),u(U,5)),e&2){let i;d(i=g())&&(n.userBubbles=i),d(i=g())&&(n.assistantBubbles=i),d(i=g())&&(n.loadingBubbles=i),d(i=g())&&(n.sendButtons=i),d(i=g())&&(n.messageInputs=i)}},inputs:{systemMessage:"systemMessage",apiKey:"apiKey"},decls:13,vars:7,consts:[["messageInput",""],["sendButton",""],["userBubble",""],["assistantBubble",""],["loadingBubble",""],[1,"w-full"],[1,"flex","flex-col","space-y-4","p-4"],[1,"text-center","text-gray-500","p-4"],[1,"flex","justify-end",2,"margin-top","-20px"],[1,"flex","justify-start"],[1,"input-area","w-full","p-4","bg-transparent","border-t","border-unrender-purple/20"],[1,"flex","items-center","space-x-3"],["placeholder","Como posso ajudar?","rows","3",1,"flex-1","bg-white/10","text-unrender-purple","rounded-lg","p-3","outline-none","focus:ring-2","focus:ring-unrender-accent","resize-none","border","border-unrender-purple/30","placeholder-unrender-purple",2,"max-height","120px","overflow-y","auto",3,"ngModelChange","keydown.enter","focus","blur","ngModel","disabled"],[1,"p-3","bg-unrender-accent","text-white","rounded-full","h-12","w-12","flex","items-center","justify-center","flex-shrink-0","hover:bg-unrender-accent/80","focus:outline-none","focus:ring-2","focus:ring-unrender-accent","disabled:bg-unrender-purple","disabled:cursor-not-allowed",3,"click","disabled"],[1,"fa-solid","fa-paper-plane"],[1,"max-w-[80%]","rounded-lg","p-3","text-white","bg-unrender-accent","shadow-md"],[1,"chat-bubble","max-w-[80%]","rounded-lg","p-3","text-white","bg-unrender-purple","shadow-md"],[3,"innerHTML"],[1,"loading-dots"]],template:function(e,n){if(e&1){let i=x();a(0,"div",5)(1,"div",6),m(2,j,3,0,"div",7),m(3,H,4,1,"div",8),m(4,q,4,1,"div",9),m(5,F,7,0,"div",9),r(),a(6,"div",10)(7,"div",11)(8,"textarea",12,0),I("ngModelChange",function(b){return l(i),T(n.currentMessage,b)||(n.currentMessage=b),c(b)}),v("keydown.enter",function(b){return l(i),c(n.onEnterKey(b))})("focus",function(){return l(i),c(n.onInputFocus())})("blur",function(){return l(i),c(n.onInputBlur())}),r(),a(10,"button",13,1),v("click",function(){return l(i),c(n.sendMessage())}),C(12,"i",14),r()()()()}e&2&&(o(2),f(!n.latestUserMessage&&!n.latestAssistantMessage&&!n.isLoading?2:-1),o(),f(n.latestUserMessage?3:-1),o(),f(n.latestAssistantMessage?4:-1),o(),f(n.isLoading?5:-1),o(3),B("ngModel",n.currentMessage),M("disabled",n.isLoading),o(2),M("disabled",n.isLoading||n.currentMessage.trim()===""))},dependencies:[k,W,L,Q,V],styles:["[_nghost-%COMP%]{display:block;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif}.chat-bubble[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:700;color:#fbbf24}.chat-bubble[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{font-style:italic;color:#e5e7eb}.chat-bubble[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background-color:#ffffff1a;padding:2px 6px;border-radius:4px;font-family:Monaco,Menlo,Ubuntu Mono,monospace;font-size:.9em;color:#fbbf24}.chat-bubble[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{background-color:#ffffff1a;padding:12px;border-radius:6px;margin:8px 0;overflow-x:auto;font-family:Monaco,Menlo,Ubuntu Mono,monospace;font-size:.85em;color:#e5e7eb}.chat-bubble[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background:none;padding:0;border-radius:0}.chat-bubble[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%], .chat-bubble[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%]{margin:8px 0;padding-left:20px}.chat-bubble[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:4px 0;color:#e5e7eb}.chat-bubble[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%], .chat-bubble[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .chat-bubble[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:12px 0 8px;color:#fbbf24;font-weight:600}.chat-bubble[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.25em}.chat-bubble[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.125em}.chat-bubble[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1em}.chat-bubble[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fbbf24;text-decoration:underline}.chat-bubble[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#f59e0b}.chat-bubble[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:8px 0;color:#e5e7eb}.loading-dots[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}.loading-dots[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:6px;height:6px;border-radius:50%;background-color:#fbbf24;animation:_ngcontent-%COMP%_loading-dots 1.4s infinite ease-in-out}.loading-dots[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){animation-delay:-.32s}.loading-dots[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){animation-delay:-.16s}.loading-dots[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(3){animation-delay:0s}@keyframes _ngcontent-%COMP%_loading-dots{0%,80%,to{transform:scale(.8);opacity:.5}40%{transform:scale(1);opacity:1}}"]})};export{$ as a};
