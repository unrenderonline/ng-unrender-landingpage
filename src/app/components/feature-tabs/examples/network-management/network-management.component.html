<div class="w-full h-full bg-white text-slate-700 p-4 rounded-xl overflow-hidden flex flex-col gap-4 font-sans border border-slate-200 shadow-lg">
  
  <!-- Dashboard Header -->
  <div class="flex justify-between items-center border-b border-slate-200 pb-4">
    <div class="flex items-center gap-3">
      <div class="w-10 h-10 bg-unrender-purple rounded-lg flex items-center justify-center shadow-lg shadow-indigo-500/20">
        <fa-icon [icon]="faNetworkWired" class="text-white text-xl"></fa-icon>
      </div>
      <div>
        <h2 class="font-bold text-lg leading-tight text-unrender-purple">Enterprise Network Monitor</h2>
        <div class="text-xs text-slate-500 flex items-center gap-2">
          <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
          System Operational
        </div>
      </div>
    </div>

    <!-- Top Stats -->
    <div class="flex gap-6">
      <div class="text-right">
        <div class="text-[10px] text-slate-500 uppercase tracking-wider">Bandwidth</div>
        <div class="text-lg font-mono font-bold text-unrender-purple">{{ totalBandwidth | number:'1.1-1' }} Gbps</div>
      </div>
      <div class="text-right">
        <div class="text-[10px] text-slate-500 uppercase tracking-wider">Latency</div>
        <div class="text-lg font-mono font-bold text-green-600">{{ avgLatency | number:'1.0-0' }} ms</div>
      </div>
      <div class="text-right">
        <div class="text-[10px] text-slate-500 uppercase tracking-wider">Threats</div>
        <div class="text-lg font-mono font-bold text-red-600">{{ threatsBlocked }}</div>
      </div>
    </div>
  </div>

  <!-- Main Visualization Area -->
  <div class="flex-1 relative bg-gray-50 rounded-xl border border-slate-200 overflow-hidden shadow-inner">
    
    <!-- Grid Background -->
    <div class="absolute inset-0 opacity-20 pointer-events-none" 
         style="background-image: linear-gradient(#cbd5e1 1px, transparent 1px), linear-gradient(90deg, #cbd5e1 1px, transparent 1px); background-size: 40px 40px;">
    </div>

    <!-- SVG Layer for Links & Packets -->
    <svg class="absolute inset-0 w-full h-full pointer-events-none z-0">
      <defs>
        <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
          <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
          <feMerge>
            <feMergeNode in="coloredBlur"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
      </defs>

      <!-- Links -->
      <g *ngFor="let link of links">
        <line [attr.x1]="getNodeById(link.sourceId)?.x + '%'" 
              [attr.y1]="getNodeById(link.sourceId)?.y + '%'" 
              [attr.x2]="getNodeById(link.targetId)?.x + '%'" 
              [attr.y2]="getNodeById(link.targetId)?.y + '%'" 
              stroke="#cbd5e1" 
              stroke-width="2" 
              [attr.stroke-opacity]="0.5" />
              
        <!-- Active Link Highlight -->
        <line *ngIf="link.active"
              [attr.x1]="getNodeById(link.sourceId)?.x + '%'" 
              [attr.y1]="getNodeById(link.sourceId)?.y + '%'" 
              [attr.x2]="getNodeById(link.targetId)?.x + '%'" 
              [attr.y2]="getNodeById(link.targetId)?.y + '%'" 
              stroke="#10051c" 
              stroke-width="2" 
              stroke-opacity="0.8"
              filter="url(#glow)" />
      </g>

      <!-- Packets -->
      <circle *ngFor="let packet of packets" 
              r="3" 
              [attr.fill]="packet.color"
              filter="url(#glow)">
          <!-- Calculate position based on current step and progress -->
          <ng-container *ngIf="getNodeById(packet.path[packet.currentStep]) as startNode">
            <ng-container *ngIf="getNodeById(packet.path[packet.currentStep + 1]) as endNode">
              <animate attributeName="cx" [attr.from]="startNode.x + '%'" [attr.to]="endNode.x + '%'" dur="0.1s" fill="freeze" />
              <!-- Manual positioning via TS is smoother for complex logic, but let's try direct binding -->
            </ng-container>
          </ng-container>
      </circle>
      
      <!-- Manual Packet Positioning (Better Control) -->
      <circle *ngFor="let packet of packets" 
              r="4" 
              [attr.fill]="packet.color"
              [attr.cx]="(getNodeById(packet.path[packet.currentStep])!.x + ((getNodeById(packet.path[packet.currentStep+1])?.x || getNodeById(packet.path[packet.currentStep])!.x) - getNodeById(packet.path[packet.currentStep])!.x) * (packet.progress / 100)) + '%'"
              [attr.cy]="(getNodeById(packet.path[packet.currentStep])!.y + ((getNodeById(packet.path[packet.currentStep+1])?.y || getNodeById(packet.path[packet.currentStep])!.y) - getNodeById(packet.path[packet.currentStep])!.y) * (packet.progress / 100)) + '%'">
      </circle>

    </svg>

    <!-- Nodes (HTML Layer for interactivity/tooltips) -->
    <div *ngFor="let node of nodes" 
         class="absolute transform -translate-x-1/2 -translate-y-1/2 flex flex-col items-center group cursor-pointer z-10"
         [style.left.%]="node.x" 
         [style.top.%]="node.y">
      
      <!-- Node Icon Circle -->
      <div class="w-12 h-12 rounded-full bg-white border-2 flex items-center justify-center transition-all duration-300 relative shadow-sm"
           [ngClass]="{
             'border-slate-300': node.status === 'online' && node.load < 50,
             'border-unrender-purple shadow-[0_0_15px_rgba(16,5,28,0.3)]': node.load >= 50,
             'border-red-500 shadow-[0_0_15px_rgba(239,68,68,0.5)]': node.status === 'warning'
           }">
        
        <fa-icon [icon]="node.icon" 
                 class="text-lg transition-colors"
                 [ngClass]="{
                   'text-slate-500': node.status === 'online',
                   'text-unrender-purple': node.load >= 50,
                   'text-red-400': node.status === 'warning'
                 }"></fa-icon>

        <!-- Status Dot -->
        <div class="absolute -top-1 -right-1 w-3 h-3 rounded-full border-2 border-white"
             [ngClass]="{
               'bg-green-500': node.status === 'online',
               'bg-red-500': node.status === 'warning' || node.status === 'offline'
             }"></div>
      </div>

      <!-- Label -->
      <div class="mt-2 bg-white/90 backdrop-blur px-2 py-1 rounded text-[10px] font-mono text-slate-700 border border-slate-200 opacity-70 group-hover:opacity-100 transition-opacity text-center whitespace-nowrap shadow-sm">
        <div class="font-bold">{{ node.name }}</div>
        <div class="text-slate-500">{{ node.ip }}</div>
      </div>

    </div>

  </div>

  <!-- Legend / Controls -->
  <div class="flex justify-between items-center text-xs text-slate-500 px-2">
    <div class="flex gap-4">
      <div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-blue-400"></span> HTTP</div>
      <div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-yellow-400"></span> Database</div>
      <div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-purple-400"></span> Stream</div>
      <div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-green-400"></span> VoIP</div>
    </div>
    <div>
      Topology: Hierarchical Tree
    </div>
  </div>

</div>
